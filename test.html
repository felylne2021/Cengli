<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign</title>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/ethers/6.8.0/ethers.umd.min.js"
      integrity="sha512-R7ASZgpXeoiujgi/4yoTErsG7ZWVq57+vLtQmFZV1LKap0Gmgbc/QeafAmOz1n66/iKfp+w5mSKabl/6Mi6UKg=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>

    <script
      src="https://cdnjs.cloudflare.com/ajax/libs/axios/1.5.1/axios.min.js"
      integrity="sha512-emSwuKiMyYedRwflbZB2ghzX8Cw8fmNVgZ6yQNNXXagFzFOaQmbvQ1vmDkddHjm5AITcBIZfC7k4ShQSjgPAmQ=="
      crossorigin="anonymous"
      referrerpolicy="no-referrer"
    ></script>
  </head>
  <body></body>

  <script>
    const EIP712_SAFE_TX_TYPES = {
      SafeTx: [
        { type: "address", name: "to" },
        { type: "uint256", name: "value" },
        { type: "bytes", name: "data" },
        { type: "uint8", name: "operation" },
        { type: "uint256", name: "safeTxGas" },
        { type: "uint256", name: "baseGas" },
        { type: "uint256", name: "gasPrice" },
        { type: "address", name: "gasToken" },
        { type: "address", name: "refundReceiver" },
        { type: "uint256", name: "nonce" },
      ],
    };

    const signTransaction = async () => {
      // approve
      // const toBeSignedData = {
      //   domain: {
      //     chainId: "43113",
      //     verifyingContract: "0x1E1960b1528541fa85a331C8933521073D6d3682",
      //   },
      //   types: {
      //     to: "0x5425890298aed601595a70AB815c96711a31Bc65",
      //     value: "0",
      //     data: "0x095ea7b3000000000000000000000000ffe648692689bd72ba223f3fec1d16a0d9e7fadb00000000000000000000000000000000000000000000000000000002540be400",
      //     operation: "0",
      //     safeTxGas: "0",x
      //     baseGas: "0",
      //     gasPrice: "0",
      //     gasToken: "0x0000000000000000000000000000000000000000",
      //     refundReceiver: "0x0000000000000000000000000000000000000000",
      //     nonce: "16",
      //   },
      // };
      // cctp trf
      const toBeSignedData = {
        domain: {
          chainId: "43113",
          verifyingContract: "0x1E1960b1528541fa85a331C8933521073D6d3682",
        },
        types: {
          to: "0xfFE648692689bD72Ba223F3feC1D16a0d9e7FAdB",
          value: "0",
          data: "0x3b8597360000000000000000000000000000000000000000000000000000000000000005000000000000000000000000278a2d5b5c8696882d1d2002ce107efc74704ecf00000000000000000000000000000000000000000000000000000000000f4240",
          operation: "0",
          safeTxGas: "0",
          baseGas: "0",
          gasPrice: "0",
          gasToken: "0x0000000000000000000000000000000000000000",
          refundReceiver: "0x0000000000000000000000000000000000000000",
          nonce: "17",
        },
      };
      console.log("toBeSignedData", toBeSignedData);

      const comethWalletAddress = "0x1E1960b1528541fa85a331C8933521073D6d3682";
      const walletPrivateKey =
        "0x09913785ce30baabcead5164541216f1e07150fb0f23620ac9d58de284521699";

      // Setup provider and wallet instance
      const provider = new ethers.JsonRpcProvider(
        "https://avalanche-fuji.infura.io/v3/0be86a45a4c3431398571a7c81165708"
      );
      const walletInstance = new ethers.Wallet(walletPrivateKey, provider);

      console.log("walletInstance", walletInstance);
      const signedTx = await walletInstance.signTypedData(
        toBeSignedData.domain,
        EIP712_SAFE_TX_TYPES,
        toBeSignedData.types
      );
      toBeSignedData.types.signatures = signedTx;

      console.log("signedTx", signedTx);

      const sendRelayTxRes = await axios({
        method: "POST",
        url: `https://api.connect.cometh.io/wallets/${comethWalletAddress}/relay`,
        headers: {
          apiKey: "a83131c6-6c56-48d2-bacd-09ad4c24428b",
        },
        data: toBeSignedData.types,
      });

      console.log("sendRelayTxRes", sendRelayTxRes.data);
    };

    signTransaction();
  </script>
</html>
